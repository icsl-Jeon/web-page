import Image from "next/image";

## Docker: Concepts

### [Docker](https://docker-curriculum.com/)

- Tools providing functions very similar to `chroot` (having different users for
  ubuntu).
- Packaging and deploying an application with all of its dependencies into a
  standardized unit (sandbox).
- Low overhead compared to other VMs.

### Docker image and containers

- Image: distributable and read-only template defined by Dockerfile
- Container: runnable instance derived from image
- [Docker hub](https://hub.docker.com/search?q=&type=image): public registry for
  docker images

## Setting up with WSL2 (windows)

- Installing
  [Docker Desktop](https://desktop.docker.com/win/main/amd64/Docker%20Desktop%20Installer.exe?_gl=1*1edbzco*_ga*NjMxOTU5MTcwLjE2ODkxNjI2NTM.*_ga_XJWPQMJYHQ*MTY4OTUwMjIxNi40LjEuMTY4OTUwMjMyMy40OC4wLjA.)
- Run and modify settings
  <div className="">
    <Image
      src="/images/post18/docker-setting.png"
      width={500}
      height={500}
      className="my-3"
    />
  </div>
- Go to WSL terminal and type `docker`.

## Commands

- Checking status

  ```
  docker ps
  docker images
  ```

- Pull existing image

  ```
  docker pull osrf/ros:humble-desktop
  docker pull bfjeon/ros2-humble
  ```

- Create container and run

  ```
  docker run -it osrf/ros:humble-desktop
  docker run --name <container-name> -it <your-image>
  docker run -it  --env="DISPLAY"  --volume="/tmp/.X11-unix:/tmp/.X11-unix:rw" --volume="/dev/dri:/dev/dri" bfjeon/ros2-humble
  ```

- Start existing container

  ```
  docker start <container-name>
  ```

- Accessing after run

  ```
  docker exec -it <container-name>

  ```

- Build `Dockerfile`

  ```
  docker build -t <name-of-local-image> .
  docker tag <name-of-local-image> bfjeon/<hub-repo-name>
  ```

- Commit

  - Run a container from an image (terminal A)

    ```
    docker run --name <container-name> -it <your-image>
    root@53b8f7a9215e sudo apt-get install vim #example
    ```

  - Commit and push the current container into an new image (terminal B)

    ```
    docker commit <container-image> <your-image>
    docker push <your-image>

    ```

- Push
  ```
  docker login -u bfjeon
  docker push bfjeon/<hub-repo-name>
  ```

## Troubleshooting

### bash completion and apt-get install autocomplete

```
apt-get install bash-completion
vim ~/.bashrc
```

Uncomment the below:

```
if [ -f /etc/bash_completion ] && ! shopt -oq posix; then
    . /etc/bash_completion
fi
```

If necessary, comment out all the lines inside

```
vim /etc/apt/apt.conf.d/docker-clean
```

### GUI for gazebo, rviz2

#### Local host setup

```
sudo apt install x11-xserver-utils
xhost +local:docker

# make new container
docker run -it  --env="DISPLAY"   --volume="/tmp/.X11-unix:/tmp/.X11-unix:rw" --volume="/dev/dri:/dev/dri" bfjeon/ros2-humble

# or start existing container
docker start <container name>
```

#### To access the running container

```
docker exec -it <container name> /bin/bash

```

#### Commands needed for running gui properly

Of course, my docker image has already handled this.
[Mesa](https://github.com/ros2/rviz/issues/834)
